To get Tables (Order and Return)
Use https://github.com/mrityunjay2805/sql_practice/blob/main/Superstore_orders.xls
Use https://github.com/mrityunjay2805/sql_practice/blob/main/returns.xls
Order_id is the foreign key


1) write a sql to get all the orders where customers name has "a" as second character and "d" as fourth character

select * from Orders
where customer_name like '_a%' and customer_name like '___d%'

OR w can
select * from Orders where customer_name like '_a_d%'


2) write a sql to get all the orders placed in the month of dec 2020

Select * from Orders where DATEPART(YEAR, order_date) = '2020' and DATEPART(MONTH, order_date) = '12'

Or we can
Select * from Orders where order_date between '2020-12-01' and '2020-12-31'


3) write a query to get all the orders where ship_mode is neither in 'Standard Class' nor in 'First Class' and ship_date is
after nov 2020

select * from Orders where ship_mode not in ('Standard Class', 'First Class') and ship_date > '2020-11-30'


4) write a query to get all the orders where customer name neither start with "A" and nor ends with "n"

Select * from Orders where customer_name not like 'A%n'


5) write a query to get all the orders where profit is negative

select * from Orders where profit < 0


6) write a query to get all the orders where either quantity is less than 3 or profit is 0

select * from Orders where quantity < 3 or profit = 0


7) your manager handles the sales for South region and he wants you to create a report of all the orders in his region 
here some discount is provided to the customers

select * from Orders where region = 'South' and discount > 0


8) write a query to find top 5 orders with highest sales in furniture category 

select top 5 * from Orders where category = 'Furniture' order by sales desc


9)write a query to find all the records in technology and furniture category for the orders placed in the year 2020 only

select * from Orders where category in ('Furniture', 'Technology') 
and order_date between '2020-01-01' and '2020-12-31'


OR we can 
select * from Orders where category in ('Furniture', 'Technology')
and datepart(YEAR, order_date) = '2020'

10) write a query to find all the orders where order date is in year 2020 but ship date is in 2021

select * from Orders where order_date between '2020-01-01' and '2020-12-31'
and ship_date between '2021-01-01' and '2021-12-31'

Or we can
select * from Orders where DATEPART(YEAR, order_date) = '2020' and
DATEPART(YEAR, ship_date) = '2021'


11) write a update statement to update city as null for order ids :  CA-2020-161389 , US-2021-156909

update orders set city=null where order_id in ('CA-2020-161389','US-2021-156909')


12) write a query to find orders where city is null

select * from orders where city is null


13) write a query to get total profit, first order date and latest order date for each category

select sum(sales) as Total_profit, min(order_date) as first_order_date, max(order_date) as latest_ordr_date
from Orders group by category


14) write a query to find sub-categories where average profit is more than the half of the max profit 
in that sub-category

select sub_category from Orders group by sub_category having avg(profit) > 0.5 * Max(profit)


15) write a query to find total number of products in each category

select category,count(distinct product_id) as no_of_prod from Orders group by category


16) write a query to find top 5 sub categories in west region by total quantity sold

select top 5  sub_category, sum(quantity) as total_quantity
from Orders
where region='West'
group by sub_category
order by total_quantity desc


17) write a query to find total sales for each region and ship mode combination for orders in year 2020

select region,ship_mode ,sum(sales) as total_sales
from Orders
where order_date between '2020-01-01' and '2020-12-31'
group by region,ship_mode


18) write a query to get region wise count of return orders

select region, count(distinct o.order_id) as no_of_return_order
from Orders o inner join returns$ r on o.order_id = r.[Order Id]
group by region


19) write a query to get category wise sales of orders that were not returned

select category, sum(sales) as total_sales
from Orders o left join returns$ r on o.order_id = r.[Order Id]
where r.[Order Id] is null
group by category


20) write a query to print sub categories where we have all 3 kinds of returns (others,bad quality,wrong items)

select o.sub_category
from Orders o inner join returns$ r on o.order_id = r.[Order Id]
group by o.sub_category
having count(distinct r.[Return Reason]) = 3



21) write a query to find cities where not even a single order was returned.

select distinct city
from Orders o
left join returns$ r on o.order_id=r.[Order Id]
group by city
having count(r.[Order Id])=0


22) write a query to find top 3 subcategories by sales of returned orders in east region

select top 3 sub_category, sum(sales) as sales_from_returned_orders
from Orders o inner join returns$ r 
on o.order_id = r.[Order Id]
where region = 'East'
group by sub_category
order by sales_from_returned_orders desc


23) write a query to find subcategories who never had any return orders in the month of november (irrespective of years)

select sub_category from
Orders o left join returns$ r on o.order_id = r.[Order Id]
where DATEPART(MONTH, order_date) = 11
group by sub_category 
having count(r.[Order Id]) = 0


24) orders table can have multiple rows for a particular order_id when customers buys more than 1 product in an order.
write a query to find order ids where there is only 1 product bought by the customer.

select order_id from Orders
group by order_id
having COUNT(*) = 1


25) write a query to get number of business days between order_date and ship_date (exclude weekends). 
Assume that all order date and ship date are on weekdays only


select  order_id, order_date, ship_date, 
DATEDIFF(day, order_date, ship_date) - 2* DATEDIFF(WEEK, order_date, ship_date) as no_of_business_days
from Orders


26) write a query to print 3 columns : category, total_sales and (total sales of returned orders)

select category, sum(sales) as total_sales, sum(case when r.[Order Id] is not null then sales end) as return_order_sales
from Orders o left join returns$ r on o.order_id = r.[Order Id]
group by category


27) write a query to print below 3 columns
category, total_sales_2019(sales in year 2019), total_sales_2020(sales in year 2020)

select category, sum(case when DATEPART(YEAR, order_date)= 2019 then sales end) as total_sales_2019,
sum(case when DATEPART(YEAR, order_date)=2020 then sales end)as total_sales_2020
from Orders
group by category
